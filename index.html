<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script language="javascript" type="text/javascript" src="/node_modules/web3/dist/web3.min.js"></script>
    <script language="javascript" type="text/javascript" src="/lifeNumberABI.js"></script>
    
    <script>

      var lifeNumber;
      var userAccount;

      function startApp() {

        //var lifNumberAddress = "0x7EF2e0048f5bAeDe046f6BF797943daF4ED8CB47";
        //var lifNumberAddress = "0x4306cd312b6907152532ea6633F7ECBB02aAB032";
        //var lifNumberAddress = "0xDA0bab807633f07f013f94DD0E6A4F96F8742B53";
        //lifeNumber = new web3js.eth.Contract(lifeNumberABI, lifNumberAddress);
        lifeNumber = new web3js.eth.Contract(lifeNumberABI,"0xaf5114c36ba3a4f38487f061c38eb61ad3c3ac8a");

        console.log(lifeNumber);

        /*
        var accountInterval = setInterval(function() {
          // 계정이 바뀌었는지 확인
          if (web3.eth.accounts[0] !== userAccount) {
            userAccount = web3.eth.accounts[0];
            // 새 계정에 대한 UI로 업데이트하기 위한 함수 호출
            //getZombiesByOwner(userAccount).then(displayZombies);
          }
        }, 100);
        */
      }

      function getNumbers() {
        return lifeNumber.methods.getNumbers().call();
      }

      function getYourNumber() {
        getNumbers().then(function(numbers){
          console.log(numbers);
        });
      }

      window.addEventListener('load', function() {

        // Web3가 브라우저에 주입되었는지 확인(Mist/MetaMask)
        if (typeof web3 !== 'undefined') {
          // Mist/MetaMask의 프로바이더 사용
          //web3js = new Web3(web3.currentProvider);
          //web3js = new Web3("https://ropsten.infura.io/v3/756e93cab9384ec98f391021c9251d90");
          
          web3js = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/v3/756e93cab9384ec98f391021c9251d90"));
          //web3js = new Web3(new Web3.providers.WebsocketProvider("wss://ropsten.infura.io/ws/v3/756e93cab9384ec98f391021c9251d90"));

        } else {
          // 사용자가 Metamask를 설치하지 않은 경우에 대해 처리
          // 사용자들에게 Metamask를 설치하라는 등의 메세지를 보여줄 것
        }

        startApp();
      })

    </script>

    <title>Vite App</title>
  </head>
  <body>
    <h1>Take Your Number</h1>
    <h3>It is Life Number</h3>

    <button type="button" onclick="getYourNumber()">get number</button>

    <div id="app">
    </div>
    
    <script type="module" src="/main.js"></script>
  </body>
</html>